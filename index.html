<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galaxy Defense - Juego de Defensa Espacial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #000428, #004e92, #0f0c29);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(90deg, #00c9ff, #92fe9d, #ff7e5f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 30px;
            position: relative;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 20, 40, 0.5);
            border-radius: 20px;
            z-index: -1;
            border: 2px solid #00c9ff;
            box-shadow: 0 0 50px rgba(0, 201, 255, 0.5);
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 #000;
            letter-spacing: 2px;
            animation: titleGlow 2s infinite alternate;
        }
        
        @keyframes titleGlow {
            from { text-shadow: 3px 3px 0 #000, 0 0 20px #00c9ff; }
            to { text-shadow: 3px 3px 0 #000, 0 0 30px #92fe9d, 0 0 40px #ff7e5f; }
        }
        
        .game-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .game-board {
            background: rgba(0, 10, 30, 0.8);
            border-radius: 15px;
            padding: 15px;
            border: 3px solid #00c9ff;
            box-shadow: 0 0 30px rgba(0, 201, 255, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 600px;
        }
        
        .game-board::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 201, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(146, 254, 157, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }
        
        #gameCanvas {
            width: 100%;
            height: 600px;
            background: linear-gradient(135deg, #000428, #004e92);
            border-radius: 10px;
            border: 2px solid #92fe9d;
            display: block;
            cursor: crosshair;
        }
        
        .grid-overlay {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 2px;
            pointer-events: none;
            z-index: 1;
        }
        
        .grid-cell {
            border: 1px dashed rgba(0, 201, 255, 0.3);
            transition: all 0.3s;
        }
        
        .grid-cell.valid {
            background: rgba(0, 201, 255, 0.1);
            border-color: rgba(146, 254, 157, 0.5);
        }
        
        .grid-cell.invalid {
            background: rgba(255, 126, 95, 0.1);
            border-color: rgba(255, 126, 95, 0.5);
        }
        
        .tower-placed {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            z-index: 2;
        }
        
        .tower-placed:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px currentColor;
        }
        
        .tower-placed.selected {
            box-shadow: 0 0 30px gold;
            z-index: 3;
        }
        
        .tower-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background: gold;
            color: black;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            border: 2px solid white;
        }
        
        .enemy {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: left 0.1s linear, top 0.1s linear;
            z-index: 2;
        }
        
        .projectile {
            position: absolute;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            z-index: 1;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #ff7e5f;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.premium {
            background: linear-gradient(135deg, #8E2DE2, #4A00E0);
        }
        
        .stat-card.danger {
            background: linear-gradient(135deg, #FF416C, #FF4B2B);
        }
        
        .stat-card.success {
            background: linear-gradient(135deg, #00b09b, #96c93d);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 0 #000;
        }
        
        .controls-sidebar {
            background: rgba(0, 10, 30, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #8E2DE2;
            box-shadow: 0 0 30px rgba(142, 45, 226, 0.3);
            overflow-y: auto;
            max-height: 600px;
        }
        
        .tower-options {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tower-card {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .tower-card:hover {
            transform: translateX(5px);
            border-color: #00c9ff;
            box-shadow: 0 5px 15px rgba(0, 201, 255, 0.4);
        }
        
        .tower-card.selected {
            border-color: #ff7e5f;
            background: linear-gradient(135deg, #2a5298, #1e3c72);
            box-shadow: 0 0 20px rgba(255, 126, 95, 0.5);
        }
        
        .tower-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 0 5px currentColor);
        }
        
        .tower-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #92fe9d;
        }
        
        .tower-cost {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .tower-stats {
            font-size: 0.8rem;
            color: #aaa;
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        
        .btn {
            background: linear-gradient(45deg, #00c9ff, #92fe9d);
            color: #000;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin: 10px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 201, 255, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.5s;
        }
        
        .btn:hover::after {
            left: 100%;
        }
        
        .btn-premium {
            background: linear-gradient(45deg, #8E2DE2, #4A00E0);
            color: white;
        }
        
        .btn-premium:hover {
            box-shadow: 0 10px 20px rgba(142, 45, 226, 0.4);
        }
        
        .wave-info {
            background: rgba(255, 126, 95, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #ff7e5f;
            position: relative;
            overflow: hidden;
        }
        
        .wave-info::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 126, 95, 0.2), transparent);
            animation: waveGlow 3s infinite;
        }
        
        @keyframes waveGlow {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .wave-progress {
            height: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
            border: 2px solid #00b09b;
        }
        
        .wave-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00b09b, #96c93d);
            width: 0%;
            transition: width 0.5s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        
        .wave-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .shop {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border: 2px solid #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .shop-item {
            background: rgba(255, 215, 0, 0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .shop-item:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.05);
        }
        
        .game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .game-over-content {
            background: linear-gradient(135deg, #000428, #004e92);
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            border: 5px solid #ffd700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            max-width: 600px;
            width: 90%;
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 70px rgba(255, 215, 0, 0.8); }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            opacity: 0.7;
        }
        
        .combo-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 30px currentColor;
            z-index: 100;
            display: none;
            animation: comboPop 0.5s;
        }
        
        @keyframes comboPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            70% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .damage-popup {
            position: absolute;
            color: #ff4444;
            font-weight: bold;
            pointer-events: none;
            z-index: 50;
            animation: floatUp 1s forwards;
            text-shadow: 2px 2px 0 #000;
        }
        
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }
        
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
            }
            
            .stats-bar {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 2.5rem;
            }
        }
        
        .tower-description {
            font-size: 0.8rem;
            color: #ccc;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ GALAXY DEFENSE</h1>
            <p>Defiende la Base Espacial de las Hordas Alien√≠genas</p>
        </header>
        
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-label">üí∞ Cr√©ditos</div>
                <div class="stat-value" id="gold">1000</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">‚öîÔ∏è Oleada</div>
                <div class="stat-value" id="wave">1</div>
            </div>
            <div class="stat-card danger">
                <div class="stat-label">‚ù§Ô∏è Escudos</div>
                <div class="stat-value" id="lives">25</div>
            </div>
            <div class="stat-card success">
                <div class="stat-label">üéØ Puntos</div>
                <div class="stat-value" id="points">0</div>
            </div>
            <div class="stat-card premium">
                <div class="stat-label">üíé Energ√≠a</div>
                <div class="stat-value" id="gems">100</div>
            </div>
        </div>
        
        <div class="game-container">
            <div class="game-board">
                <canvas id="gameCanvas" width="800" height="600"></canvas>
                <div class="grid-overlay" id="gridOverlay"></div>
                
                <div class="wave-info">
                    <h3>üåä Progreso de la Oleada</h3>
                    <div class="wave-progress">
                        <div class="wave-progress-bar" id="waveProgress"></div>
                    </div>
                    <p id="waveStatus">Construye torres de defensa para proteger la base espacial</p>
                    <div class="controls">
                        <button class="btn" id="startWave">
                            ‚öîÔ∏è INICIAR OLEADA
                        </button>
                        <button class="btn btn-premium" id="specialPower">
                            ‚ú® BOMBA DE NEUTRINOS (25 energ√≠a)
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="controls-sidebar">
                <h2 style="color: #92fe9d; margin-bottom: 20px; text-align: center;">üõ∏ TORRES DE DEFENSA</h2>
                
                <div class="tower-options">
                    <div class="tower-card" data-tower="laser" data-cost="200">
                        <div class="tower-icon" style="color: #00c9ff;">üî´</div>
                        <div class="tower-name">Torre L√°ser</div>
                        <div class="tower-cost">200 ü™ô</div>
                        <div class="tower-stats">
                            <span>üéØ Da√±o: 25</span>
                            <span>‚ö° Vel: R√°pida</span>
                        </div>
                        <div class="tower-description">Dispara rayos l√°ser de alta precisi√≥n</div>
                    </div>
                    
                    <div class="tower-card" data-tower="missile" data-cost="350">
                        <div class="tower-icon" style="color: #ff7e5f;">üöÄ</div>
                        <div class="tower-name">Torre de Misiles</div>
                        <div class="tower-cost">350 ü™ô</div>
                        <div class="tower-stats">
                            <span>üéØ Da√±o: 45</span>
                            <span>‚ú® AOE: S√≠</span>
                        </div>
                        <div class="tower-description">Misiles guiados con da√±o en √°rea</div>
                    </div>
                    
                    <div class="tower-card" data-tower="plasma" data-cost="500">
                        <div class="tower-icon" style="color: #ffd700;">üí•</div>
                        <div class="tower-name">Torre de Plasma</div>
                        <div class="tower-cost">500 ü™ô</div>
                        <div class="tower-stats">
                            <span>üéØ Da√±o: 75</span>
                            <span>üí• Explosi√≥n</span>
                        </div>
                        <div class="tower-description">Proyectiles de plasma que explotan al impacto</div>
                    </div>
                    
                    <div class="tower-card" data-tower="freeze" data-cost="300">
                        <div class="tower-icon" style="color: #92fe9d;">‚ùÑÔ∏è</div>
                        <div class="tower-name">Torre Criog√©nica</div>
                        <div class="tower-cost">300 ü™ô</div>
                        <div class="tower-stats">
                            <span>üéØ Da√±o: 20</span>
                            <span>üêå Congela</span>
                        </div>
                        <div class="tower-description">Ralentiza a los enemigos con congelaci√≥n</div>
                    </div>
                    
                    <div class="tower-card" data-tower="ion" data-cost="800">
                        <div class="tower-icon" style="color: #8E2DE2;">‚ö°</div>
                        <div class="tower-name">Torre de Iones</div>
                        <div class="tower-cost">800 ü™ô</div>
                        <div class="tower-stats">
                            <span>üéØ Da√±o: 100</span>
                            <span>üî• Cadena</span>
                        </div>
                        <div class="tower-description">Descargas i√≥nicas que saltan entre enemigos</div>
                    </div>
                </div>
                
                <button class="btn" id="upgradeAll">
                    ‚ö° MEJORAR TODAS (300 cr√©ditos)
                </button>
                
                <button class="btn" id="sellTower">
                    üí∞ VENDER TORRE (75%)
                </button>
                
                <div class="shop">
                    <h3 style="color: #ffd700; text-align: center; margin-bottom: 15px;">üè™ TIENDA ESPACIAL</h3>
                    
                    <div class="shop-item" id="buyGold">
                        <span style="font-size: 1.5rem;">ü™ô</span>
                        <div>
                            <div><strong>+500 Cr√©ditos</strong></div>
                            <div style="color: #ffd700;">10 üíé</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" id="buyLives">
                        <span style="font-size: 1.5rem;">‚ù§Ô∏è</span>
                        <div>
                            <div><strong>+5 Escudos</strong></div>
                            <div style="color: #ffd700;">15 üíé</div>
                        </div>
                    </div>
                    
                    <div class="shop-item" id="buyDamage">
                        <span style="font-size: 1.5rem;">‚ö°</span>
                        <div>
                            <div><strong>x2 Da√±o 30s</strong></div>
                            <div style="color: #ffd700;">20 üíé</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="combo-display" id="comboDisplay"></div>
    
    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2 id="gameOverTitle" style="font-size: 3rem; color: #ffd700; margin-bottom: 20px;">üèÜ BASE DEFENDIDA</h2>
            <div id="victoryIcon" style="font-size: 6rem; margin: 20px 0;">üöÄ</div>
            <p id="gameOverMessage" style="font-size: 1.2rem; margin-bottom: 20px;">Has protegido la base espacial con √©xito</p>
            <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin: 20px 0;">
                <p style="margin-bottom: 10px;">Oleada alcanzada: <span id="finalWave" style="color: #ffd700;">1</span></p>
                <p style="margin-bottom: 10px;">Puntuaci√≥n final: <span id="finalScore" style="color: #ffd700;">0</span></p>
                <p style="margin-bottom: 10px;">Cr√©ditos obtenidos: <span id="finalGold" style="color: #ffd700;">0</span></p>
            </div>
            <button class="btn" id="restartGame" style="width: 200px; margin: 20px auto;">
                üîÑ JUGAR DE NUEVO
            </button>
        </div>
    </div>

    <script>
        // Variables del juego
        let gameState = {
            gold: 1000,
            wave: 1,
            lives: 25,
            points: 0,
            gems: 100,
            waveActive: false,
            selectedTower: null,
            towers: [],
            enemies: [],
            projectiles: [],
            path: [],
            grid: [],
            selectedTowerElement: null,
            combo: 0,
            comboTimeout: null,
            gameOver: false,
            towerTypes: {
                laser: { damage: 25, range: 150, speed: 10, color: "#00c9ff", icon: "üî´", cost: 200 },
                missile: { damage: 45, range: 120, speed: 6, color: "#ff7e5f", icon: "üöÄ", cost: 350, aoe: true },
                plasma: { damage: 75, range: 100, speed: 4, color: "#ffd700", icon: "üí•", cost: 500, explosion: true },
                freeze: { damage: 20, range: 130, speed: 8, color: "#92fe9d", icon: "‚ùÑÔ∏è", cost: 300, slow: true },
                ion: { damage: 100, range: 180, speed: 3, color: "#8E2DE2", icon: "‚ö°", cost: 800, chain: true }
            },
            enemyTypes: [
                { health: 50, speed: 1, color: "#FF416C", reward: 25, icon: "üëæ" },
                { health: 80, speed: 0.8, color: "#FF4B2B", reward: 40, icon: "üëΩ" },
                { health: 120, speed: 0.6, color: "#8E2DE2", reward: 60, icon: "ü§ñ" },
                { health: 200, speed: 0.4, color: "#00c9ff", reward: 100, icon: "üõ∏" }
            ]
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            setupEventListeners();
            createGrid();
            generatePath();
            gameLoop();
        });

        function initGame() {
            updateUI();
        }

        function createGrid() {
            const gridOverlay = document.getElementById('gridOverlay');
            gridOverlay.innerHTML = '';
            gameState.grid = [];
            
            const cols = 8;
            const rows = 6;
            const cellWidth = 800 / cols;
            const cellHeight = 600 / rows;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.style.gridColumn = col + 1;
                    cell.style.gridRow = row + 1;
                    
                    // Marcar celdas que est√°n en el camino como no v√°lidas
                    const x = col * cellWidth + cellWidth/2;
                    const y = row * cellHeight + cellHeight/2;
                    
                    // Verificar si esta celda est√° cerca del camino
                    let nearPath = false;
                    for (let i = 0; i < gameState.path.length; i++) {
                        const pathPoint = gameState.path[i];
                        const distance = Math.sqrt(Math.pow(x - pathPoint.x, 2) + Math.pow(y - pathPoint.y, 2));
                        if (distance < 40) {
                            nearPath = true;
                            break;
                        }
                    }
                    
                    gameState.grid.push({
                        x: col * cellWidth,
                        y: row * cellHeight,
                        width: cellWidth,
                        height: cellHeight,
                        centerX: x,
                        centerY: y,
                        occupied: false,
                        nearPath: nearPath
                    });
                    
                    gridOverlay.appendChild(cell);
                }
            }
        }

        function generatePath() {
            // Generar un camino en zigzag para los enemigos
            gameState.path = [];
            const startX = 0;
            const startY = 300;
            
            // Puntos de control del camino
            const points = [
                { x: startX, y: startY },
                { x: 200, y: 100 },
                { x: 400, y: 500 },
                { x: 600, y: 200 },
                { x: 800, y: 400 }
            ];
            
            // Crear camino suave entre puntos
            for (let i = 0; i < points.length - 1; i++) {
                const p1 = points[i];
                const p2 = points[i + 1];
                const steps = 20;
                
                for (let j = 0; j <= steps; j++) {
                    const t = j / steps;
                    const x = p1.x + (p2.x - p1.x) * t;
                    const y = p1.y + (p2.y - p1.y) * t;
                    gameState.path.push({ x, y });
                }
            }
        }

        function setupEventListeners() {
            // Selecci√≥n de torres
            document.querySelectorAll('.tower-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.tower-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    
                    gameState.selectedTower = card.dataset.tower;
                    gameState.selectedTowerElement = card;
                    
                    // Actualizar celdas de la grilla
                    updateGridCells();
                });
            });

            // Colocaci√≥n de torres
            document.getElementById('gameCanvas').addEventListener('click', (e) => {
                if (!gameState.selectedTower || gameState.waveActive) return;
                
                const rect = e.target.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Encontrar la celda m√°s cercana
                const cell = findClosestCell(x, y);
                
                if (cell && !cell.occupied && !cell.nearPath) {
                    const towerType = gameState.towerTypes[gameState.selectedTower];
                    
                    if (gameState.gold >= towerType.cost) {
                        gameState.gold -= towerType.cost;
                        
                        const tower = {
                            type: gameState.selectedTower,
                            x: cell.centerX - 40,
                            y: cell.centerY - 40,
                            centerX: cell.centerX,
                            centerY: cell.centerY,
                            damage: towerType.damage,
                            range: towerType.range,
                            speed: towerType.speed,
                            color: towerType.color,
                            icon: towerType.icon,
                            level: 1,
                            lastShot: 0,
                            aoe: towerType.aoe || false,
                            explosion: towerType.explosion || false,
                            slow: towerType.slow || false,
                            chain: towerType.chain || false
                        };
                        
                        gameState.towers.push(tower);
                        cell.occupied = true;
                        
                        // Crear elemento visual de la torre
                        createTowerElement(tower);
                        
                        updateUI();
                    } else {
                        showMessage("¬°No tienes suficientes cr√©ditos!", "#FF416C");
                    }
                }
            });

            // Bot√≥n de iniciar oleada
            document.getElementById('startWave').addEventListener('click', () => {
                if (!gameState.waveActive && !gameState.gameOver) {
                    startWave();
                }
            });

            // Bot√≥n de poder especial
            document.getElementById('specialPower').addEventListener('click', () => {
                if (gameState.gems >= 25 && gameState.waveActive) {
                    gameState.gems -= 25;
                    activateNeutrinoBomb();
                    updateUI();
                }
            });

            // Bot√≥n de mejorar todas las torres
            document.getElementById('upgradeAll').addEventListener('click', () => {
                if (gameState.gold >= 300 && gameState.towers.length > 0) {
                    gameState.gold -= 300;
                    gameState.towers.forEach(tower => {
                        tower.level++;
                        tower.damage = Math.floor(tower.damage * 1.5);
                        tower.range = Math.floor(tower.range * 1.2);
                        tower.speed = Math.floor(tower.speed * 1.1);
                    });
                    updateUI();
                    showMessage("¬°Todas las torres mejoradas!", "#92fe9d");
                }
            });

            // Bot√≥n de vender torre
            document.getElementById('sellTower').addEventListener('click', () => {
                const selectedTower = document.querySelector('.tower-placed.selected');
                if (selectedTower) {
                    const towerId = selectedTower.dataset.id;
                    const towerIndex = gameState.towers.findIndex(t => t.id == towerId);
                    
                    if (towerIndex !== -1) {
                        const tower = gameState.towers[towerIndex];
                        const refund = Math.floor(towerType[tower.type].cost * 0.75);
                        gameState.gold += refund;
                        
                        // Liberar la celda
                        const cell = findCellAtPosition(tower.centerX, tower.centerY);
                        if (cell) cell.occupied = false;
                        
                        // Eliminar torre
                        gameState.towers.splice(towerIndex, 1);
                        selectedTower.remove();
                        
                        updateUI();
                        showMessage(`Torre vendida por ${refund} cr√©ditos`, "#ffd700");
                    }
                }
            });

            // Tienda
            document.getElementById('buyGold').addEventListener('click', () => {
                if (gameState.gems >= 10) {
                    gameState.gems -= 10;
                    gameState.gold += 500;
                    updateUI();
                    showMessage("+500 cr√©ditos adquiridos", "#ffd700");
                }
            });

            document.getElementById('buyLives').addEventListener('click', () => {
                if (gameState.gems >= 15) {
                    gameState.gems -= 15;
                    gameState.lives += 5;
                    updateUI();
                    showMessage("+5 escudos adquiridos", "#00c9ff");
                }
            });

            document.getElementById('buyDamage').addEventListener('click', () => {
                if (gameState.gems >= 20) {
                    gameState.gems -= 20;
                    activateDoubleDamage();
                    updateUI();
                    showMessage("Da√±o doble activado por 30 segundos", "#FF416C");
                }
            });

            // Reiniciar juego
            document.getElementById('restartGame').addEventListener('click', () => {
                resetGame();
            });
        }

        function findClosestCell(x, y) {
            let closestCell = null;
            let minDistance = Infinity;
            
            gameState.grid.forEach(cell => {
                const distance = Math.sqrt(Math.pow(x - cell.centerX, 2) + Math.pow(y - cell.centerY, 2));
                if (distance < minDistance) {
                    minDistance = distance;
                    closestCell = cell;
                }
            });
            
            return closestCell;
        }

        function findCellAtPosition(x, y) {
            return gameState.grid.find(cell => 
                Math.abs(cell.centerX - x) < 5 && Math.abs(cell.centerY - y) < 5
            );
        }

        function updateGridCells() {
            document.querySelectorAll('.grid-cell').forEach((cell, index) => {
                const gridCell = gameState.grid[index];
                cell.classList.remove('valid', 'invalid');
                
                if (gameState.selectedTower && !gameState.waveActive) {
                    if (gridCell.occupied || gridCell.nearPath) {
                        cell.classList.add('invalid');
                    } else {
                        cell.classList.add('valid');
                    }
                }
            });
        }

        function createTowerElement(tower) {
            const gameBoard = document.querySelector('.game-board');
            const towerElement = document.createElement('div');
            tower.id = 'tower_' + Date.now() + Math.random();
            towerElement.dataset.id = tower.id;
            
            towerElement.className = 'tower-placed';
            towerElement.style.left = tower.x + 'px';
            towerElement.style.top = tower.y + 'px';
            towerElement.style.backgroundColor = tower.color + '30';
            towerElement.style.border = `2px solid ${tower.color}`;
            towerElement.style.color = tower.color;
            
            towerElement.innerHTML = `
                <div style="font-size: 24px;">${tower.icon}</div>
                <div style="font-size: 12px; margin-top: 5px;">Nivel ${tower.level}</div>
                <div class="tower-level">${tower.level}</div>
            `;
            
            towerElement.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.tower-placed').forEach(t => t.classList.remove('selected'));
                towerElement.classList.add('selected');
            });
            
            gameBoard.appendChild(towerElement);
        }

        function startWave() {
            gameState.waveActive = true;
            document.getElementById('startWave').disabled = true;
            document.getElementById('startWave').textContent = `OLEADA ${gameState.wave} EN CURSO`;
            
            // Generar enemigos seg√∫n la oleada
            const enemyCount = 5 + gameState.wave * 2;
            const enemyTypeIndex = Math.min(Math.floor(gameState.wave / 3), gameState.enemyTypes.length - 1);
            
            for (let i = 0; i < enemyCount; i++) {
                setTimeout(() => {
                    if (!gameState.gameOver) {
                        spawnEnemy(enemyTypeIndex);
                    }
                }, i * 1000);
            }
            
            // Actualizar progreso de la oleada
            updateWaveProgress();
        }

        function spawnEnemy(typeIndex) {
            const enemyType = gameState.enemyTypes[typeIndex];
            const enemy = {
                id: Date.now() + Math.random(),
                type: typeIndex,
                health: enemyType.health * (1 + (gameState.wave - 1) * 0.2),
                maxHealth: enemyType.health * (1 + (gameState.wave - 1) * 0.2),
                speed: enemyType.speed,
                color: enemyType.color,
                icon: enemyType.icon,
                reward: enemyType.reward + gameState.wave * 5,
                pathIndex: 0,
                x: gameState.path[0].x,
                y: gameState.path[0].y,
                slowDuration: 0
            };
            
            gameState.enemies.push(enemy);
            
            // Crear elemento visual del enemigo
            createEnemyElement(enemy);
        }

        function createEnemyElement(enemy) {
            const gameBoard = document.querySelector('.game-board');
            const enemyElement = document.createElement('div');
            enemyElement.dataset.id = enemy.id;
            
            enemyElement.className = 'enemy';
            enemyElement.style.left = (enemy.x - 20) + 'px';
            enemyElement.style.top = (enemy.y - 20) + 'px';
            enemyElement.style.backgroundColor = enemy.color;
            enemyElement.style.boxShadow = `0 0 10px ${enemy.color}`;
            
            enemyElement.innerHTML = `
                <div>${enemy.icon}</div>
                <div style="position: absolute; bottom: -20px; width: 40px; height: 4px; background: #333; border-radius: 2px;">
                    <div style="height: 100%; width: ${(enemy.health / enemy.maxHealth) * 100}%; background: #ff4444; border-radius: 2px;"></div>
                </div>
            `;
            
            gameBoard.appendChild(enemyElement);
        }

        function activateNeutrinoBomb() {
            // Eliminar todos los enemigos en pantalla
            gameState.enemies.forEach(enemy => {
                gameState.points += enemy.reward * 2;
                gameState.gold += enemy.reward;
                
                // Crear efecto visual
                createExplosion(enemy.x, enemy.y, enemy.color);
            });
            
            gameState.enemies = [];
            document.querySelectorAll('.enemy').forEach(e => e.remove());
            
            showMessage("¬°Bomba de neutrinos activada!", "#8E2DE2");
        }

        function activateDoubleDamage() {
            const originalDamage = {};
            
            // Guardar da√±o original y duplicarlo
            gameState.towers.forEach(tower => {
                originalDamage[tower.id] = tower.damage;
                tower.damage *= 2;
            });
            
            // Restaurar despu√©s de 30 segundos
            setTimeout(() => {
                gameState.towers.forEach(tower => {
                    if (originalDamage[tower.id]) {
                        tower.damage = originalDamage[tower.id];
                    }
                });
            }, 30000);
        }

        function createExplosion(x, y, color) {
            const gameBoard = document.querySelector('.game-board');
            
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.backgroundColor = color;
                
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 5 + 2;
                const vx = Math.cos(angle) * speed;
                const vy = Math.sin(angle) * speed;
                
                gameBoard.appendChild(particle);
                
                let opacity = 0.7;
                const animate = () => {
                    opacity -= 0.02;
                    particle.style.opacity = opacity;
                    particle.style.left = parseFloat(particle.style.left) + vx + 'px';
                    particle.style.top = parseFloat(particle.style.top) + vy + 'px';
                    
                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        particle.remove();
                    }
                };
                
                animate();
            }
        }

        function updateWaveProgress() {
            const progressBar = document.getElementById('waveProgress');
            const waveStatus = document.getElementById('waveStatus');
            
            if (gameState.waveActive) {
                const interval = setInterval(() => {
                    if (gameState.enemies.length === 0 && !gameState.gameOver) {
                        clearInterval(interval);
                        endWave();
                    } else {
                        const progress = (gameState.enemies.length / (5 + gameState.wave * 2)) * 100;
                        progressBar.style.width = (100 - progress) + '%';
                        waveStatus.textContent = `Enemigos restantes: ${gameState.enemies.length}`;
                    }
                }, 1000);
            }
        }

        function endWave() {
            gameState.waveActive = false;
            gameState.wave++;
            gameState.gold += 100 * gameState.wave;
            gameState.gems += 5;
            
            document.getElementById('startWave').disabled = false;
            document.getElementById('startWave').textContent = `‚öîÔ∏è INICIAR OLEADA ${gameState.wave}`;
            
            updateUI();
            
            if (gameState.wave % 5 === 0) {
                showMessage(`¬°Oleada ${gameState.wave} completada! Recompensa extra: +100 energ√≠a`, "#ffd700");
                gameState.gems += 20;
            } else {
                showMessage(`¬°Oleada ${gameState.wave - 1} completada!`, "#92fe9d");
            }
            
            // Actualizar progreso
            document.getElementById('waveProgress').style.width = '0%';
            document.getElementById('waveStatus').textContent = 'Prepar√°ndose para la pr√≥xima oleada...';
        }

        function gameLoop() {
            updateEnemies();
            updateTowers();
            updateProjectiles();
            checkGameOver();
            
            requestAnimationFrame(gameLoop);
        }

        function updateEnemies() {
            gameState.enemies.forEach((enemy, index) => {
                // Actualizar posici√≥n en el camino
                if (enemy.pathIndex < gameState.path.length - 1) {
                    const targetPoint = gameState.path[enemy.pathIndex + 1];
                    const dx = targetPoint.x - enemy.x;
                    const dy = targetPoint.y - enemy.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // Aplicar ralentizaci√≥n si est√° activa
                    const actualSpeed = enemy.slowDuration > 0 ? enemy.speed * 0.3 : enemy.speed;
                    
                    if (distance < actualSpeed) {
                        enemy.pathIndex++;
                    } else {
                        enemy.x += (dx / distance) * actualSpeed;
                        enemy.y += (dy / distance) * actualSpeed;
                    }
                    
                    // Actualizar elemento visual
                    const enemyElement = document.querySelector(`.enemy[data-id="${enemy.id}"]`);
                    if (enemyElement) {
                        enemyElement.style.left = (enemy.x - 20) + 'px';
                        enemyElement.style.top = (enemy.y - 20) + 'px';
                        
                        // Actualizar barra de salud
                        const healthBar = enemyElement.querySelector('div > div');
                        if (healthBar) {
                            healthBar.style.width = `${(enemy.health / enemy.maxHealth) * 100}%`;
                        }
                    }
                    
                    // Verificar si lleg√≥ al final del camino
                    if (enemy.pathIndex >= gameState.path.length - 1) {
                        gameState.lives--;
                        enemyElement.remove();
                        gameState.enemies.splice(index, 1);
                        updateUI();
                        
                        if (enemy.slowDuration > 0) {
                            enemy.slowDuration--;
                        }
                        
                        createDamagePopup(enemy.x, enemy.y, "-1 ‚ù§Ô∏è", "#FF416C");
                    }
                }
            });
        }

        function updateTowers() {
            const currentTime = Date.now();
            
            gameState.towers.forEach(tower => {
                // Encontrar el enemigo m√°s cercano
                let target = null;
                let minDistance = Infinity;
                
                gameState.enemies.forEach(enemy => {
                    const dx = enemy.x - tower.centerX;
                    const dy = enemy.y - tower.centerY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < tower.range && distance < minDistance) {
                        minDistance = distance;
                        target = enemy;
                    }
                });
                
                // Disparar al objetivo
                if (target && currentTime - tower.lastShot > 1000 / tower.speed) {
                    tower.lastShot = currentTime;
                    
                    // Crear proyectil
                    const projectile = {
                        x: tower.centerX,
                        y: tower.centerY,
                        target: target,
                        color: tower.color,
                        damage: tower.damage,
                        aoe: tower.aoe,
                        explosion: tower.explosion,
                        slow: tower.slow,
                        chain: tower.chain
                    };
                    
                    gameState.projectiles.push(projectile);
                    createProjectileElement(projectile);
                }
            });
        }

        function updateProjectiles() {
            gameState.projectiles.forEach((projectile, index) => {
                if (!projectile.target || projectile.target.health <= 0) {
                    // Eliminar proyectil si el objetivo ya no existe
                    const projectileElement = document.querySelector(`.projectile[data-id="${projectile.id}"]`);
                    if (projectileElement) projectileElement.remove();
                    gameState.projectiles.splice(index, 1);
                    return;
                }
                
                // Mover proyectil hacia el objetivo
                const dx = projectile.target.x - projectile.x;
                const dy = projectile.target.y - projectile.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const speed = 10;
                
                if (distance < speed) {
                    // Impacto
                    applyDamage(projectile);
                    
                    // Eliminar proyectil
                    const projectileElement = document.querySelector(`.projectile[data-id="${projectile.id}"]`);
                    if (projectileElement) projectileElement.remove();
                    gameState.projectiles.splice(index, 1);
                } else {
                    projectile.x += (dx / distance) * speed;
                    projectile.y += (dy / distance) * speed;
                    
                    // Actualizar elemento visual
                    const projectileElement = document.querySelector(`.projectile[data-id="${projectile.id}"]`);
                    if (projectileElement) {
                        projectileElement.style.left = projectile.x + 'px';
                        projectileElement.style.top = projectile.y + 'px';
                    }
                }
            });
        }

        function applyDamage(projectile) {
            const damage = projectile.damage;
            const target = projectile.target;
            
            // Aplicar da√±o al objetivo principal
            target.health -= damage;
            
            // Mostrar popup de da√±o
            createDamagePopup(target.x, target.y, `-${damage}`, projectile.color);
            
            // Efectos especiales
            if (projectile.slow) {
                target.slowDuration = 60; // 60 frames = 1 segundo a 60 FPS
            }
            
            if (projectile.explosion) {
                // Da√±o en √°rea
                gameState.enemies.forEach(enemy => {
                    if (enemy !== target) {
                        const dx = enemy.x - target.x;
                        const dy = enemy.y - target.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 80) {
                            enemy.health -= damage * 0.5;
                            createDamagePopup(enemy.x, enemy.y, `-${Math.floor(damage * 0.5)}`, projectile.color);
                        }
                    }
                });
                
                createExplosion(target.x, target.y, projectile.color);
            }
            
            // Verificar si el enemigo fue eliminado
            if (target.health <= 0) {
                // Recompensas
                gameState.gold += target.reward;
                gameState.points += target.reward * 10;
                
                // Combo
                gameState.combo++;
                if (gameState.combo > 1) {
                    showCombo(gameState.combo);
                }
                
                // Resetear combo despu√©s de 3 segundos
                clearTimeout(gameState.comboTimeout);
                gameState.comboTimeout = setTimeout(() => {
                    if (gameState.combo > 3) {
                        showMessage(`Combo x${gameState.combo}!`, "#ffd700");
                        gameState.gems += Math.floor(gameState.combo / 3);
                    }
                    gameState.combo = 0;
                }, 3000);
                
                // Eliminar enemigo
                const enemyElement = document.querySelector(`.enemy[data-id="${target.id}"]`);
                if (enemyElement) enemyElement.remove();
                
                const enemyIndex = gameState.enemies.findIndex(e => e.id === target.id);
                if (enemyIndex !== -1) {
                    gameState.enemies.splice(enemyIndex, 1);
                }
                
                updateUI();
            }
        }

        function createProjectileElement(projectile) {
            const gameBoard = document.querySelector('.game-board');
            const projectileElement = document.createElement('div');
            projectile.id = 'projectile_' + Date.now() + Math.random();
            projectileElement.dataset.id = projectile.id;
            
            projectileElement.className = 'projectile';
            projectileElement.style.left = projectile.x + 'px';
            projectileElement.style.top = projectile.y + 'px';
            projectileElement.style.backgroundColor = projectile.color;
            projectileElement.style.boxShadow = `0 0 5px ${projectile.color}`;
            
            gameBoard.appendChild(projectileElement);
        }

        function createDamagePopup(x, y, text, color) {
            const gameBoard = document.querySelector('.game-board');
            const popup = document.createElement('div');
            popup.className = 'damage-popup';
            popup.textContent = text;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            popup.style.color = color;
            
            gameBoard.appendChild(popup);
            
            setTimeout(() => {
                popup.remove();
            }, 1000);
        }

        function showCombo(combo) {
            const comboDisplay = document.getElementById('comboDisplay');
            comboDisplay.textContent = `COMBO x${combo}!`;
            comboDisplay.style.display = 'block';
            
            setTimeout(() => {
                comboDisplay.style.display = 'none';
            }, 1000);
        }

        function checkGameOver() {
            if (gameState.lives <= 0 && !gameState.gameOver) {
                gameState.gameOver = true;
                endGame(false);
            }
            
            // Victoria despu√©s de 20 oleadas
            if (gameState.wave > 20 && !gameState.gameOver) {
                gameState.gameOver = true;
                endGame(true);
            }
        }

        function endGame(victory) {
            const gameOverScreen = document.getElementById('gameOver');
            const title = document.getElementById('gameOverTitle');
            const message = document.getElementById('gameOverMessage');
            const icon = document.getElementById('victoryIcon');
            const finalWave = document.getElementById('finalWave');
            const finalScore = document.getElementById('finalScore');
            const finalGold = document.getElementById('finalGold');
            
            if (victory) {
                title.textContent = "üèÜ VICTORIA TOTAL";
                message.textContent = "¬°Has defendido la base espacial de todas las oleadas alien√≠genas!";
                icon.textContent = "üöÄ";
                icon.style.color = "#ffd700";
            } else {
                title.textContent = "üíÄ BASE DESTRUIDA";
                message.textContent = "Los alien√≠genas han superado tus defensas. La base ha ca√≠do.";
                icon.textContent = "üëæ";
                icon.style.color = "#FF416C";
            }
            
            finalWave.textContent = gameState.wave - 1;
            finalScore.textContent = gameState.points;
            finalGold.textContent = gameState.gold;
            
            gameOverScreen.style.display = 'flex';
        }

        function resetGame() {
            // Resetear estado del juego
            gameState = {
                gold: 1000,
                wave: 1,
                lives: 25,
                points: 0,
                gems: 100,
                waveActive: false,
                selectedTower: null,
                towers: [],
                enemies: [],
                projectiles: [],
                path: gameState.path,
                grid: gameState.grid,
                selectedTowerElement: null,
                combo: 0,
                comboTimeout: null,
                gameOver: false,
                towerTypes: gameState.towerTypes,
                enemyTypes: gameState.enemyTypes
            };
            
            // Limpiar elementos visuales
            document.querySelectorAll('.tower-placed, .enemy, .projectile, .damage-popup').forEach(el => el.remove());
            document.querySelectorAll('.tower-card').forEach(c => c.classList.remove('selected'));
            
            // Actualizar UI
            updateUI();
            updateGridCells();
            
            // Ocultar pantalla de game over
            document.getElementById('gameOver').style.display = 'none';
            
            // Restaurar bot√≥n de oleada
            document.getElementById('startWave').disabled = false;
            document.getElementById('startWave').textContent = '‚öîÔ∏è INICIAR OLEADA';
            
            // Restaurar mensajes
            document.getElementById('waveStatus').textContent = 'Construye torres de defensa para proteger la base espacial';
            document.getElementById('waveProgress').style.width = '0%';
        }

        function updateUI() {
            document.getElementById('gold').textContent = gameState.gold;
            document.getElementById('wave').textContent = gameState.wave;
            document.getElementById('lives').textContent = gameState.lives;
            document.getElementById('points').textContent = gameState.points;
            document.getElementById('gems').textContent = gameState.gems;
            
            // Actualizar estado del bot√≥n de poder especial
            document.getElementById('specialPower').disabled = gameState.gems < 25 || !gameState.waveActive;
        }

        function showMessage(text, color) {
            const message = document.createElement('div');
            message.textContent = text;
            message.style.position = 'fixed';
            message.style.top = '20px';
            message.style.left = '50%';
            message.style.transform = 'translateX(-50%)';
            message.style.backgroundColor = color;
            message.style.color = 'white';
            message.style.padding = '15px 30px';
            message.style.borderRadius = '10px';
            message.style.zIndex = '1000';
            message.style.fontWeight = 'bold';
            message.style.boxShadow = '0 5px 15px rgba(0,0,0,0.3)';
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.opacity = '0';
                message.style.transition = 'opacity 0.5s';
                setTimeout(() => message.remove(), 500);
            }, 2000);
        }
    </script>
</body>
</html>